<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="EllarSQL, designed for Ellar, enhances your application by integrating support for SQLAlchemy and Alembic."><link href=https://github.com/python-ellar/ellar-sql/models/ rel=canonical><link href=../overview/configuration/ rel=prev><link href=extra-fields/ rel=next><link rel=icon href=../img/ellar_sql.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.49"><title>index -</title><link rel=stylesheet href=../assets/stylesheets/main.6f8fc17f.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Source Sans Pro";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#models-and-tables class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title class="md-header__button md-logo" aria-label data-md-component=logo> <img src=../img/ellar_sql.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> index </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=cyan aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=cyan aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/python-ellar/ellar-sql title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> python-ellar/ellar-sql </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title class="md-nav__button md-logo" aria-label data-md-component=logo> <img src=../img/ellar_sql.png alt=logo> </a> </label> <div class=md-nav__source> <a href=https://github.com/python-ellar/ellar-sql title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> python-ellar/ellar-sql </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Get Started </span> </a> </li> <li class=md-nav__item> <a href=../overview/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Models </span> </a> <label class="md-nav__link md-nav__link--active" for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Models </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=extra-fields/ class=md-nav__link> <span class=md-ellipsis> Extra Fields </span> </a> </li> <li class=md-nav__item> <a href=file-fields/ class=md-nav__link> <span class=md-ellipsis> File and Image Fields </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../pagination/ class=md-nav__link> <span class=md-ellipsis> Pagination </span> </a> </li> <li class=md-nav__item> <a href=../multiple/ class=md-nav__link> <span class=md-ellipsis> Multiple Database </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../migrations/ class=md-nav__link> <span class=md-ellipsis> Migrations </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#creating-a-base-class class=md-nav__link> <span class=md-ellipsis> Creating a Base Class </span> </a> </li> <li class=md-nav__item> <a href=#create-base-with-metadata class=md-nav__link> <span class=md-ellipsis> Create base with MetaData </span> </a> </li> <li class=md-nav__item> <a href=#abstract-models-and-mixins class=md-nav__link> <span class=md-ellipsis> Abstract Models and Mixins </span> </a> </li> <li class=md-nav__item> <a href=#defining-models class=md-nav__link> <span class=md-ellipsis> Defining Models </span> </a> </li> <li class=md-nav__item> <a href=#defining-tables class=md-nav__link> <span class=md-ellipsis> Defining Tables </span> </a> </li> <li class=md-nav__item> <a href=#quick-tutorial class=md-nav__link> <span class=md-ellipsis> Quick Tutorial </span> </a> <nav class=md-nav aria-label="Quick Tutorial"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#insert class=md-nav__link> <span class=md-ellipsis> Insert </span> </a> </li> <li class=md-nav__item> <a href=#update class=md-nav__link> <span class=md-ellipsis> Update </span> </a> </li> <li class=md-nav__item> <a href=#delete class=md-nav__link> <span class=md-ellipsis> Delete </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#view-utilities class=md-nav__link> <span class=md-ellipsis> View Utilities </span> </a> </li> <li class=md-nav__item> <a href=#accessing-metadata-and-engines class=md-nav__link> <span class=md-ellipsis> Accessing Metadata and Engines </span> </a> <nav class=md-nav aria-label="Accessing Metadata and Engines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#important-constraints class=md-nav__link> <span class=md-ellipsis> Important Constraints </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/python-ellar/ellar-sql/blob/master/docs/models/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/python-ellar/ellar-sql/raw/master/docs/models/index.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=models-and-tables><strong>Models and Tables</strong><a class=headerlink href=#models-and-tables title="Permanent link">&para;</a></h1> <p>The <code>ellar_sql.model.Model</code> class acts as a factory for creating <code>SQLAlchemy</code> models, and associating the generated models with the corresponding <strong>Metadata</strong> through their designated <strong><code>__database__</code></strong> key.</p> <p>This class can be configured through the <code>__base_config__</code> attribute, allowing you to specify how your <code>SQLAlchemy</code> model should be created. The <code>__base_config__</code> attribute can be of type <code>ModelBaseConfig</code>, which is a dataclass, or a dictionary with keys that match the attributes of <code>ModelBaseConfig</code>.</p> <p>Attributes of <code>ModelBaseConfig</code>:</p> <ul> <li><strong>as_base</strong>: Indicates whether the class should be treated as a <code>Base</code> class for other model definitions, similar to creating a Base from a <a href=https://docs.sqlalchemy.org/en/20/orm/mapping_api.html#sqlalchemy.orm.DeclarativeBase target=_blank>DeclarativeBase</a> or <a href=https://docs.sqlalchemy.org/en/20/orm/mapping_api.html#sqlalchemy.orm.DeclarativeBaseNoMeta target=_blank>DeclarativeBaseNoMeta</a> class. <em>(Default: False)</em></li> <li><strong>use_base</strong>: Specifies the base classes that will be used to create the <code>SQLAlchemy</code> model. <em>(Default: [])</em></li> </ul> <h2 id=creating-a-base-class><strong>Creating a Base Class</strong><a class=headerlink href=#creating-a-base-class title="Permanent link">&para;</a></h2> <p><code>Model</code> treats each model as a standalone entity. Each instance of <code>model.Model</code> creates a distinct <strong>declarative</strong> base for itself, using the <code>__database__</code> key as a reference to determine its associated <strong>Metadata</strong>. Consequently, models sharing the same <code>__database__</code> key will utilize the same <strong>Metadata</strong> object.</p> <p>Let's explore how we can create a <code>Base</code> model using <code>Model</code>, similar to the approach in traditional <code>SQLAlchemy</code>.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span><span class=p>,</span> <span class=n>ModelBaseConfig</span>


<span class=k>class</span> <span class=nc>Base</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>__base_config__</span> <span class=o>=</span> <span class=n>ModelBaseConfig</span><span class=p>(</span><span class=n>as_base</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_bases</span><span class=o>=</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>DeclarativeBase</span><span class=p>])</span>


<span class=k>assert</span> <span class=nb>issubclass</span><span class=p>(</span><span class=n>Base</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>DeclarativeBase</span><span class=p>)</span>
</code></pre></div> <p>If you are interested in <a href=https://docs.sqlalchemy.org/en/20/changelog/whatsnew_20.html#native-support-for-dataclasses-mapped-as-orm-models target=_blank>SQLAlchemy’s native support for data classes</a>, then you can add <code>MappedAsDataclass</code> to <code>use_bases</code> as shown below:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span><span class=p>,</span> <span class=n>ModelBaseConfig</span>


<span class=k>class</span> <span class=nc>Base</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>__base_config__</span> <span class=o>=</span> <span class=n>ModelBaseConfig</span><span class=p>(</span><span class=n>as_base</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_bases</span><span class=o>=</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>DeclarativeBase</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>MappedAsDataclass</span><span class=p>])</span>

<span class=k>assert</span> <span class=nb>issubclass</span><span class=p>(</span><span class=n>Base</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>MappedAsDataclass</span><span class=p>)</span>
</code></pre></div> <p>In the examples above, <code>Base</code> classes are created, all subclassed from the <code>use_bases</code> provided, and with the <code>as_base</code> option, the factory creates the <code>Base</code> class as a <code>Base</code>.</p> <h2 id=create-base-with-metadata>Create base with MetaData<a class=headerlink href=#create-base-with-metadata title="Permanent link">&para;</a></h2> <p>You can also configure the SQLAlchemy object with a custom <a href=https://docs.sqlalchemy.org/en/20/core/metadata.html#sqlalchemy.schema.MetaData target=_blank><code>MetaData</code></a> object. For instance, you can define a specific <strong>naming convention</strong> for constraints, ensuring consistency and predictability in constraint names. This can be particularly beneficial during migrations, as detailed by <a href=https://alembic.sqlalchemy.org/en/latest/naming.html target=_blank>Alembic</a>.</p> <p>For example:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span><span class=p>,</span> <span class=n>ModelBaseConfig</span>

<span class=k>class</span> <span class=nc>Base</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>__base_config__</span> <span class=o>=</span> <span class=n>ModelBaseConfig</span><span class=p>(</span><span class=n>as_base</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_bases</span><span class=o>=</span><span class=p>[</span><span class=n>model</span><span class=o>.</span><span class=n>DeclarativeBase</span><span class=p>])</span>

    <span class=n>metadata</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>MetaData</span><span class=p>(</span><span class=n>naming_convention</span><span class=o>=</span><span class=p>{</span>
        <span class=s2>&quot;ix&quot;</span><span class=p>:</span> <span class=s1>&#39;ix_</span><span class=si>%(column_0_label)s</span><span class=s1>&#39;</span><span class=p>,</span>
        <span class=s2>&quot;uq&quot;</span><span class=p>:</span> <span class=s2>&quot;uq_</span><span class=si>%(table_name)s</span><span class=s2>_</span><span class=si>%(column_0_name)s</span><span class=s2>&quot;</span><span class=p>,</span>
        <span class=s2>&quot;ck&quot;</span><span class=p>:</span> <span class=s2>&quot;ck_</span><span class=si>%(table_name)s</span><span class=s2>_</span><span class=si>%(constraint_name)s</span><span class=s2>&quot;</span><span class=p>,</span>
        <span class=s2>&quot;fk&quot;</span><span class=p>:</span> <span class=s2>&quot;fk_</span><span class=si>%(table_name)s</span><span class=s2>_</span><span class=si>%(column_0_name)s</span><span class=s2>_</span><span class=si>%(referred_table_name)s</span><span class=s2>&quot;</span><span class=p>,</span>
        <span class=s2>&quot;pk&quot;</span><span class=p>:</span> <span class=s2>&quot;pk_</span><span class=si>%(table_name)s</span><span class=s2>&quot;</span>
    <span class=p>})</span>
</code></pre></div> <h2 id=abstract-models-and-mixins><strong>Abstract Models and Mixins</strong><a class=headerlink href=#abstract-models-and-mixins title="Permanent link">&para;</a></h2> <p>If the desired behavior is only applicable to specific models rather than all models, you can use an abstract model base class to customize only those models. For example, if certain models need to track their creation or update <strong>timestamps</strong>, t his approach allows for targeted customization.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timezone</span>
<span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span>
<span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Mapped</span><span class=p>,</span> <span class=n>mapped_column</span>

<span class=k>class</span> <span class=nc>TimestampModel</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>__abstract__</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>created</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>))</span>
    <span class=n>updated</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>),</span> <span class=n>onupdate</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>))</span>


<span class=k>class</span> <span class=nc>BookAuthor</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>name</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>TimestampModel</span><span class=p>):</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>title</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</code></pre></div> <p>This can also be done with a mixin class, inherited separately. <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timezone</span>
<span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span>
<span class=kn>from</span> <span class=nn>sqlalchemy.orm</span> <span class=kn>import</span> <span class=n>Mapped</span><span class=p>,</span> <span class=n>mapped_column</span>

<span class=k>class</span> <span class=nc>TimestampModel</span><span class=p>:</span>
    <span class=n>created</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>))</span>
    <span class=n>updated</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=n>datetime</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>),</span> <span class=n>onupdate</span><span class=o>=</span><span class=k>lambda</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>))</span>


<span class=k>class</span> <span class=nc>Book</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>,</span> <span class=n>TimestampModel</span><span class=p>):</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>title</span><span class=p>:</span> <span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>
</code></pre></div></p> <h2 id=defining-models><strong>Defining Models</strong><a class=headerlink href=#defining-models title="Permanent link">&para;</a></h2> <p>Unlike plain SQLAlchemy, <strong>EllarSQL</strong> models will automatically generate a table name if the <code>__tablename__</code> attribute is not set, provided a primary key column is defined.</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span>


<span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>username</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>email</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span>


<span class=k>class</span> <span class=nc>UserAddress</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=n>__tablename__</span> <span class=o>=</span> <span class=s1>&#39;user-address&#39;</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>address</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

<span class=k>assert</span> <span class=n>User</span><span class=o>.</span><span class=n>__tablename__</span> <span class=o>==</span> <span class=s1>&#39;user&#39;</span>
<span class=k>assert</span> <span class=n>UserAddress</span><span class=o>.</span><span class=n>__tablename__</span> <span class=o>==</span> <span class=s1>&#39;user-address&#39;</span>
</code></pre></div> For a comprehensive guide on defining model classes declaratively, refer to <a href=https://docs.sqlalchemy.org/en/20/orm/declarative_tables.html target=_blank>SQLAlchemy’s declarative documentation</a>. This resource provides detailed information and insights into the declarative approach for defining model classes.</p> <h2 id=defining-tables><strong>Defining Tables</strong><a class=headerlink href=#defining-tables title="Permanent link">&para;</a></h2> <p>The table class is designed to receive a table name, followed by <strong>columns</strong> and other table <strong>components</strong> such as constraints.</p> <p>EllarSQL enhances the functionality of the SQLAlchemy Table by facilitating the selection of <strong>Metadata</strong> based on the <code>__database__</code> argument.</p> <p>Directly creating a table proves particularly valuable when establishing <strong>many-to-many</strong> relationships. In such cases, the association table doesn't need its dedicated model class; rather, it can be conveniently accessed through the relevant relationship attributes on the associated models.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span>

<span class=n>author_book_m2m</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>Table</span><span class=p>(</span>
    <span class=s2>&quot;author_book&quot;</span><span class=p>,</span>
    <span class=n>model</span><span class=o>.</span><span class=n>Column</span><span class=p>(</span><span class=s2>&quot;book_author_id&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>BookAuthor</span><span class=o>.</span><span class=n>id</span><span class=p>),</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>model</span><span class=o>.</span><span class=n>Column</span><span class=p>(</span><span class=s2>&quot;book_id&quot;</span><span class=p>,</span> <span class=n>model</span><span class=o>.</span><span class=n>ForeignKey</span><span class=p>(</span><span class=n>Book</span><span class=o>.</span><span class=n>id</span><span class=p>),</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
<span class=p>)</span>
</code></pre></div> <h2 id=quick-tutorial><strong>Quick Tutorial</strong><a class=headerlink href=#quick-tutorial title="Permanent link">&para;</a></h2> <p>In this section, we'll delve into straightforward <strong>CRUD</strong> operations using the ORM objects. However, if you're not well-acquainted with SQLAlchemy, feel free to explore their tutorial on <a href=https://docs.sqlalchemy.org/tutorial/orm_data_manipulation.html target=_blank>ORM</a> for a more comprehensive understanding.</p> <p>Having understood, <code>Model</code> usage. Let's create a <code>User</code> model</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>model</span>


<span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
    <span class=nb>id</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>username</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>full_name</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>Mapped</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>mapped_column</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>String</span><span class=p>)</span>
</code></pre></div> We have created a <code>User</code> model but the data does not exist. Let's fix that</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.core</span> <span class=kn>import</span> <span class=n>current_injector</span>
<span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>EllarSQLService</span>

<span class=n>db_service</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>EllarSQLService</span><span class=p>)</span>
<span class=n>db_service</span><span class=o>.</span><span class=n>create_all</span><span class=p>()</span>
</code></pre></div> <h3 id=insert><strong>Insert</strong><a class=headerlink href=#insert title="Permanent link">&para;</a></h3> <p>To insert data, you need a session. Here's an example using EllarSQL to insert a user:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>ellar.common</span> <span class=k>as</span> <span class=nn>ecm</span>
<span class=kn>from</span> <span class=nn>.model</span> <span class=kn>import</span> <span class=n>User</span>

<span class=nd>@ecm</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;/create&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>create_user</span><span class=p>():</span>
    <span class=n>session</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>get_db_session</span><span class=p>()</span>
    <span class=n>squidward</span> <span class=o>=</span> <span class=n>User</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;squidward&quot;</span><span class=p>,</span> <span class=n>fullname</span><span class=o>=</span><span class=s2>&quot;Squidward Tentacles&quot;</span><span class=p>)</span>
    <span class=n>session</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>squidward</span><span class=p>)</span>

    <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>squidward</span><span class=o>.</span><span class=n>dict</span><span class=p>(</span><span class=n>exclude</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;id&#39;</span><span class=p>})</span>
</code></pre></div> <p>In the above illustration, the <code>squidward</code> data is converted to a <code>dictionary</code> object by calling <code>.dict()</code> and excluding the <code>id</code> field. The <code>User.get_db_session()</code> function is used to get the session for the registered <code>EllarSQLService.session_factory</code>. The function depends on <code>ApplicationContext</code>.</p> <h3 id=update><strong>Update</strong><a class=headerlink href=#update title="Permanent link">&para;</a></h3> <p>To update, make changes to the ORM object and commit. Here's an example using EllarSQL to update a user:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>ellar.common</span> <span class=k>as</span> <span class=nn>ecm</span>
<span class=kn>import</span> <span class=nn>sqlalchemy.orm</span> <span class=k>as</span> <span class=nn>sa_orm</span>
<span class=kn>from</span> <span class=nn>.model</span> <span class=kn>import</span> <span class=n>User</span>

<span class=nd>@ecm</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s1>&#39;/update&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>update_user</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>ecm</span><span class=o>.</span><span class=n>Inject</span><span class=p>[</span><span class=n>sa_orm</span><span class=o>.</span><span class=n>Session</span><span class=p>]):</span>
    <span class=n>squidward</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>User</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=n>squidward</span><span class=o>.</span><span class=n>fullname</span> <span class=o>=</span> <span class=s1>&#39;EllarSQL&#39;</span>
    <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>

    <span class=k>return</span> <span class=n>squidward</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span>
</code></pre></div> <p>In the above illustration, <code>Inject[sa_orm.Session]</code> is used to inject the <code>session</code> into the <code>update_user</code> route handler. This is another way to get the <code>session</code> through the <code>EllarSQLService</code> service. The changes made to the <code>squidward</code> object are committed to the database using <code>session.commit()</code>.</p> <h3 id=delete><strong>Delete</strong><a class=headerlink href=#delete title="Permanent link">&para;</a></h3> <p>To delete, pass the ORM object to <code>session.delete()</code>. <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>ellar.common</span> <span class=k>as</span> <span class=nn>ecm</span>
<span class=kn>import</span> <span class=nn>sqlalchemy.orm</span> <span class=k>as</span> <span class=nn>sa_orm</span>
<span class=kn>from</span> <span class=nn>.model</span> <span class=kn>import</span> <span class=n>User</span>


<span class=nd>@ecm</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=s1>&#39;/delete&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>delete_user</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>ecm</span><span class=o>.</span><span class=n>Inject</span><span class=p>[</span><span class=n>sa_orm</span><span class=o>.</span><span class=n>Session</span><span class=p>]):</span>
    <span class=n>squidward</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>User</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=n>session</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>squidward</span><span class=p>)</span>
    <span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>

    <span class=k>return</span> <span class=s1>&#39;&#39;</span>
</code></pre></div></p> <p>After modifying data, you must call <code>session.commit()</code> to commit the changes to the database. Otherwise, changes may not be persisted to the database.</p> <h2 id=view-utilities><strong>View Utilities</strong><a class=headerlink href=#view-utilities title="Permanent link">&para;</a></h2> <p>EllarSQL provides some utility query functions to check missing entities and raise 404 Not found if not found.</p> <ul> <li><strong>get_or_404</strong>: It will raise a 404 error if the row with the given id does not exist; otherwise, it will return the corresponding instance.</li> <li><strong>first_or_404</strong>: It will raise a 404 error if the query does not return any results; otherwise, it will return the first result.</li> <li><strong>one_or_404</strong>(): It will raise a 404 error if the query does not return exactly one result; otherwise, it will return the result.</li> </ul> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>ellar.common</span> <span class=k>as</span> <span class=nn>ecm</span>
<span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>get_or_404</span><span class=p>,</span> <span class=n>one_or_404</span><span class=p>,</span> <span class=n>model</span>

<span class=nd>@ecm</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/user-by-id/{user_id:int}&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>user_by_id</span><span class=p>(</span><span class=n>user_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
    <span class=n>user</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_or_404</span><span class=p>(</span><span class=n>User</span><span class=p>,</span> <span class=n>user_id</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>user</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span>

<span class=nd>@ecm</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/user-by-name/{name:str}&quot;</span><span class=p>)</span>
<span class=k>async</span> <span class=k>def</span> <span class=nf>user_by_username</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
    <span class=n>user</span> <span class=o>=</span> <span class=k>await</span> <span class=n>one_or_404</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>),</span> <span class=n>error_message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;No user named &#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;.&quot;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>user</span><span class=o>.</span><span class=n>dict</span><span class=p>()</span>
</code></pre></div> <h2 id=accessing-metadata-and-engines><strong>Accessing Metadata and Engines</strong><a class=headerlink href=#accessing-metadata-and-engines title="Permanent link">&para;</a></h2> <p>In the process of <code>EllarSQLModule</code> setup, three services are registered to the Ellar IoC container.</p> <ul> <li><code>EllarSQLService</code>: Which manages models, metadata, engines and sessions</li> <li><code>Engine</code>: SQLAlchemy Engine of the default database configuration</li> <li><code>Session</code>SQLAlchemy Session of the default database configuration</li> </ul> <p>Although with <code>EllarSQLService</code> you can get the <code>engine</code> and <code>session</code>. It's there for easy of access.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>sqlalchemy</span> <span class=k>as</span> <span class=nn>sa</span>
<span class=kn>import</span> <span class=nn>sqlalchemy.orm</span> <span class=k>as</span> <span class=nn>sa_orm</span>
<span class=kn>from</span> <span class=nn>ellar.core</span> <span class=kn>import</span> <span class=n>current_injector</span>
<span class=kn>from</span> <span class=nn>ellar_sql</span> <span class=kn>import</span> <span class=n>EllarSQLService</span>

<span class=n>db_service</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>EllarSQLService</span><span class=p>)</span>

<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>db_service</span><span class=o>.</span><span class=n>engine</span><span class=p>,</span> <span class=n>sa</span><span class=o>.</span><span class=n>Engine</span><span class=p>)</span>
<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>db_service</span><span class=o>.</span><span class=n>session_factory</span><span class=p>(),</span> <span class=n>sa_orm</span><span class=o>.</span><span class=n>Session</span><span class=p>)</span>
</code></pre></div> <h4 id=important-constraints><strong>Important Constraints</strong><a class=headerlink href=#important-constraints title="Permanent link">&para;</a></h4> <ul> <li>EllarSQLModule <code>databases</code> options for <code>SQLAlchemy.ext.asyncio.AsyncEngine</code> will register <code>SQLAlchemy.ext.asyncio.AsyncEngine</code> and <code>SQLAlchemy.ext.asyncio.AsyncSession</code></li> <li>EllarSQLModule <code>databases</code> options for <code>SQLAlchemy.Engine</code> will register <code>SQLAlchemy.Engine</code> and <code>SQLAlchemy.orm.Session</code>.</li> <li><code>EllarSQL.get_all_metadata()</code> retrieves all configured metadatas</li> <li><code>EllarSQL.get_metadata()</code> retrieves metadata by <code>__database__</code> key or <code>default</code> is no parameter is passed.</li> </ul> <p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>sqlalchemy</span> <span class=k>as</span> <span class=nn>sa</span>
<span class=kn>import</span> <span class=nn>sqlalchemy.orm</span> <span class=k>as</span> <span class=nn>sa_orm</span>
<span class=kn>from</span> <span class=nn>ellar.core</span> <span class=kn>import</span> <span class=n>current_injector</span>

<span class=c1># get engine from DI</span>
<span class=n>default_engine</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>sa</span><span class=o>.</span><span class=n>Engine</span><span class=p>)</span>
<span class=c1># get session from DI</span>
<span class=n>session</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>sa_orm</span><span class=o>.</span><span class=n>Session</span><span class=p>)</span>


<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>default_engine</span><span class=p>,</span> <span class=n>sa</span><span class=o>.</span><span class=n>Engine</span><span class=p>)</span>
<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>sa_orm</span><span class=o>.</span><span class=n>Session</span><span class=p>)</span>
</code></pre></div> For Async Database options <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>sqlalchemy.ext.asyncio</span> <span class=kn>import</span> <span class=n>AsyncSession</span><span class=p>,</span> <span class=n>AsyncEngine</span>
<span class=kn>from</span> <span class=nn>ellar.core</span> <span class=kn>import</span> <span class=n>current_injector</span>

<span class=c1># get engine from DI</span>
<span class=n>default_engine</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>AsyncEngine</span><span class=p>)</span>
<span class=c1># get session from DI</span>
<span class=n>session</span> <span class=o>=</span> <span class=n>current_injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>AsyncSession</span><span class=p>)</span>


<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>default_engine</span><span class=p>,</span> <span class=n>AsyncEngine</span><span class=p>)</span>
<span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>AsyncSession</span><span class=p>)</span>
</code></pre></div></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 21, 2024</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../overview/configuration/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Configuration"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Configuration </div> </div> </a> <a href=extra-fields/ class="md-footer__link md-footer__link--next" aria-label="Next: Extra Fields"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Extra Fields </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 <a href=https://github.com/eadwinCode target=_blank rel=noopener>Eadwin Ezeudoh</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "search.highlight", "search.share", "search.suggest", "toc.follow", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.prune", "navigation.left", "navigation.tracking"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.88dd0f4e.min.js></script> </body> </html>